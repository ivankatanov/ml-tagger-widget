<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multilogin Auto-Tagger</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/@livechat/agent-app-sdk@1.6.3/dist/agentapp.umd.min.js"></script>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 0; background: #f6f7fb; }
    .card { max-width: 560px; margin: 24px; padding: 16px 18px; background:#fff; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,.08); }
    .row { display:flex; gap:8px; align-items:center; margin-top:12px; }
    button { padding:8px 12px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer; }
    pre { background:#f0f3f9; padding:10px; border-radius:8px; overflow:auto; }
    .ok { color:#127e00 } .err { color:#b00020 }
  </style>
</head>
<body>
  <div class="card">
    <h3>Multilogin Auto-Tagger</h3>
    <div id="status">Widget placeholder is working ✅</div>
    <div class="row">
      <button id="initBtn">Init SDK</button>
      <button id="infoBtn" disabled>Get chat info</button>
    </div>
    <pre id="log" style="margin-top:12px;display:none;"></pre>
  </div>

  <script>
    const statusEl = document.getElementById('status');
    const logEl = document.getElementById('log');
    const initBtn = document.getElementById('initBtn');
    const infoBtn = document.getElementById('infoBtn');

    let widget = null;

    function setStatus(text, cls="") {
      statusEl.className = cls;
      statusEl.textContent = text;
    }
    function log(obj) {
      logEl.style.display = 'block';
      logEl.textContent = typeof obj === 'string' ? obj : JSON.stringify(obj, null, 2);
    }

    initBtn.addEventListener('click', async () => {
      try {
        if (!window.LiveChat) {
          setStatus('SDK object not found on window.LiveChat', 'err');
          return;
        }
        setStatus('Initializing SDK…');
        widget = await LiveChat.createDetailsWidget();
        setStatus('SDK initialized ✓', 'ok');
        infoBtn.disabled = false;
      } catch (e) {
        setStatus('SDK init failed ✗', 'err');
        log(e?.message || String(e));
      }
    });

    infoBtn.addEventListener('click', async () => {
      try {
        if (!widget) { setStatus('SDK not initialized', 'err'); return; }
        setStatus('Reading chat info…');
        const profile = await widget.getCustomerProfile();
        const chatId = profile?.chat?.chat_id || '(none)';
        const threadId = profile?.chat?.id || '(none)';
        const plan = profile?.customVariables?.Plan ?? '(no plan)';
        setStatus('Success ✓', 'ok');
        log({ chatId, threadId, plan, rawProfile: profile });
      } catch (e) {
        setStatus('Failed to read chat info ✗', 'err');
        log(e?.message || String(e));
      }
    });

    // Optionally auto-init when embedded inside Agent App
    (async () => {
      try {
        if (window.LiveChat) {
          widget = await LiveChat.createDetailsWidget();
          setStatus('SDK initialized automatically ✓', 'ok');
          infoBtn.disabled = false;
        }
      } catch (e) {
        // stay in placeholder mode
      }
    })();
  </script>
</body>
</html>
