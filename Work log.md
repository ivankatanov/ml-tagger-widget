# Журнал изменений функциональности Telegram в LiveChat

## Дата: 10.09.2023

### Внесенные изменения

#### Изменения в UI
1. Удалена кнопка "Get Telegram"
2. Поле с Telegram-ником сделано редактируемым
3. Добавлена кнопка "Update TG Username" справа от поля
4. Добавлена отдельная кнопка копирования для Telegram-ника
5. Обновлен текст инструкции под полем

#### Дополнительные изменения (11.09.2023)
1. Удалена надпись "Auto-fetch enabled - Telegram will load automatically" из поля Telegram
2. Перемещена кнопка копирования под кнопку "Update TG Username"
3. Обновлен текст подсказки для большей ясности
4. Добавлен заголовок "Telegram Username" жирным шрифтом
5. Изменена структура раздела Telegram для соответствия стилю других разделов
6. Исправлен стиль заголовка Telegram Username для соответствия другим заголовкам
7. Добавлено обновление статуса в поле Ready при поиске Telegram ника

#### Изменения в JavaScript
1. Добавлена константа `UPDATE_TELEGRAM_WEBHOOK` со значением `"https://npm.mlx.yt/webhook/livechat/update-telegram"`
2. Заменена переменная `btnTelegram` на `btnUpdateTelegram`, связанная с новой кнопкой
3. Обновлены функции `showLoading` и `hideLoading` для работы с новой кнопкой
4. Добавлен новый обработчик события для кнопки "Update TG Username", который:
   - Получает введенное пользователем значение Telegram-ника
   - Отправляет POST-запрос на webhook с данными (chat_id, thread_id, email, telegram)
   - Обрабатывает ответ и обновляет UI соответственно
5. Сохранена функция `autoGetTelegram` для автоматического получения Telegram при открытии чата

### Логика работы
1. При открытии чата автоматически запрашивается Telegram-ник пользователя через функцию `autoGetTelegram`
2. Пользователь может редактировать поле с Telegram-ником
3. При нажатии на кнопку "Update TG Username" новое значение отправляется на сервер
4. Интерфейс обновляется в соответствии с ответом сервера (успех/ошибка)
5. Кнопка копирования позволяет быстро скопировать Telegram-ник в буфер обмена

### Технические детали
- Запросы отправляются на webhook `https://npm.mlx.yt/webhook/livechat/update-telegram`
- Формат запроса: JSON с полями `chat_id`, `thread_id`, `email` и `telegram`
- Обработка различных форматов ответа для обратной совместимости